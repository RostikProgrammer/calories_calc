<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор калорійності</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f7f9fc;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .calculator {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        input[type="number"]:required, select:required {
            border-left: 4px solid #3498db;
        }
        
        .radio-group {
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .radio-option input[type="radio"] {
            margin-right: 10px;
        }
        
        .radio-option label {
            margin-bottom: 0;
            font-weight: normal;
        }
        
        .radio-value {
            font-weight: bold;
            margin-right: 8px;
            min-width: 60px;
            display: inline-block;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .results {
            background-color: #e8f4fd;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
            display: none;
        }
        
        .results h2 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .result-item {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .result-value {
            font-weight: bold;
            color: #2980b9;
        }
        
        .macro-results {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        .macro-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .macro-input {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .macro-input input {
            flex: 1;
        }
        
        .macro-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .slider-container {
            margin-top: 15px;
        }
        
        .slider-value {
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        input[type="range"] {
            width: 100%;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            color: #666;
            font-size: 14px;
        }
        
        .required-mark {
            color: #e74c3c;
            margin-left: 4px;
        }
        
        .form-group.required label:after {
            content: "*";
            color: #e74c3c;
            margin-left: 4px;
        }
        
        .form-group.required {
            margin-right: 20px;
        }
        
        /* Відлагоджувальний блок */
        .debug-info {
            background-color: #f2f2f2;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 12px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Калькулятор калорійності та макронутрієнтів</h1>
    
    <div class="calculator">
        <form id="calculatorForm">
            <div class="form-group required">
                <label for="gender">Стать</label>
                <select id="gender" required>
                    <option value="">Оберіть стать</option>
                    <option value="ч">Чоловіча</option>
                    <option value="ж">Жіноча</option>
                </select>
            </div>
            
            <div class="form-group required">
                <label for="weight">Вага (кг)</label>
                <input type="number" id="weight" min="30" max="300" step="0.1" placeholder="Наприклад: 70" required>
                <div class="error" id="weight-error">Будь ласка, введіть вагу від 30 до 300 кг</div>
            </div>
            
            <div class="form-group required">
                <label for="height">Зріст (см)</label>
                <input type="number" id="height" min="100" max="250" step="0.1" placeholder="Наприклад: 175" required>
                <div class="error" id="height-error">Будь ласка, введіть зріст від 100 до 250 см</div>
            </div>
            
            <div class="form-group required">
                <label for="age">Вік</label>
                <input type="number" id="age" min="15" max="120" step="1" placeholder="Наприклад: 25" required>
                <div class="error" id="age-error">Будь ласка, введіть вік від 15 до 120 років</div>
            </div>
            
            <div class="form-group required">
                <label>Коефіцієнт активності</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="activity1" name="activity" value="1.2" required>
                        <label for="activity1"><span class="radio-value">1.2</span> - мінімальна активність</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="activity2" name="activity" value="1.375">
                        <label for="activity2"><span class="radio-value">1.375</span> - 3 тренування на тиждень</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="activity3" name="activity" value="1.465">
                        <label for="activity3"><span class="radio-value">1.465</span> - 5 тренувань на тиждень</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="activity4" name="activity" value="1.55">
                        <label for="activity4"><span class="radio-value">1.55</span> - 5 тренувань + фізична робота</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="activity5" name="activity" value="1.6375">
                        <label for="activity5"><span class="radio-value">1.6375</span> - 7 тренувань на тиждень</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="activity6" name="activity" value="1.725">
                        <label for="activity6"><span class="radio-value">1.725</span> - 7 тренувань + фізична робота</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="activity7" name="activity" value="1.9">
                        <label for="activity7"><span class="radio-value">1.9</span> - професіонал (2 тренування в день)</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group required">
                <label for="deficit-slider">Відсоток дефіциту/профіциту</label>
                <div class="slider-container">
                    <div class="slider-value" id="deficit-value">0%</div>
                    <input type="range" id="deficit-slider" min="-50" max="50" step="10" value="0" required>
                    <div class="slider-labels">
                        <span>-50%</span>
                        <span>Дефіцит</span>
                        <span>0%</span>
                        <span>Профіцит</span>
                        <span>+50%</span>
                    </div>
                </div>
            </div>
            
            <button type="submit" id="calculate-bmr">Розрахувати BMR і калорійність</button>
        </form>
        
        <div class="results" id="bmr-results">
            <h2>Результати розрахунку</h2>
            <div class="result-item">
                BMR: <span class="result-value" id="bmr-value"></span> ккал
            </div>
            <div class="result-item">
                Денна калорійність: <span class="result-value" id="daily-calories"></span> ккал
            </div>
            <div class="result-item" id="adjusted-calories-container">
                Денна калорійність з урахуванням <span id="deficit-type"></span>: 
                <span class="result-value" id="adjusted-calories"></span> ккал
            </div>
            
            <div class="macro-results">
                <div class="macro-info">
                    <p>Рекомендовані значення:</p>
                    <p>Білки = 2 - 2.2 г на кг</p>
                    <p>Жири = 0.8 - 1.2 г на кг</p>
                    <p>Вуглеводи розраховуються автоматично, щоб досягти загальної калорійності</p>
                </div>
                
                <form id="macrosForm">
                    <div class="macro-title">Розрахунок макронутрієнтів:</div>
                    <div class="macro-input" style="display: flex; gap: 100px; margin-right: 15px;">
                        <div class="form-group required">
                            <label for="protein">Білки (г/кг)</label>
                            <input type="number" id="protein" min="0.8" max="3" step="0.1" value="2" required>
                        </div>
                        <div class="form-group required">
                            <label for="fat">Жири (г/кг)</label>
                            <input type="number" id="fat" min="0.4" max="2" step="0.1" value="1" required>
                        </div>
                    </div>
                    
                    <button type="button" id="calculate-macros">Розрахувати макронутрієнти</button>
                </form>
                
                <div class="results" id="macro-results" style="display: none; background-color: #f0f7ff; margin-top: 20px;">
                    <h3>Макронутрієнти до споживання:</h3>
                    <div class="result-item">
                        Білків: <span class="result-value" id="protein-g"></span> г - <span class="result-value" id="protein-cal"></span> ккал
                    </div>
                    <div class="result-item">
                        Жирів: <span class="result-value" id="fat-g"></span> г - <span class="result-value" id="fat-cal"></span> ккал
                    </div>
                    <div class="result-item">
                        Вуглеводів: <span class="result-value" id="carbs-g"></span> г - <span class="result-value" id="carbs-cal"></span> ккал
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Відлагоджувальний блок -->
        <div class="debug-info" id="debug-info"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculatorForm = document.getElementById('calculatorForm');
            const calculateMacrosBtn = document.getElementById('calculate-macros');
            const deficitSlider = document.getElementById('deficit-slider');
            const deficitValue = document.getElementById('deficit-value');
            const debugInfo = document.getElementById('debug-info');
            
            // Глобальні змінні для збереження розрахунків
            window.calculatedData = {
                adjustedCalories: 0,
                weight: 0,
                bmr: 0,
                dailyCalories: 0
            };
            
            // Функція для відлагодження (може бути включена за потреби)
            function debug(message) {
                debugInfo.innerHTML += message + '<br>';
                // Для відображення відлагоджувальної інформації розкоментуйте наступний рядок
                // debugInfo.style.display = 'block';
            }
            
            // Оновлення значення слайдера
            deficitSlider.addEventListener('input', function() {
                const value = this.value;
                if (value > 0) {
                    deficitValue.textContent = '+' + value + '%';
                } else {
                    deficitValue.textContent = value + '%';
                }
            });
            
            // Обробка відправлення форми
            calculatorForm.addEventListener('submit', function(e) {
                e.preventDefault();
                debug('Форма відправлена');
                calculateBMR();
            });
            
            // Обробка натискання кнопки розрахунку макронутрієнтів
            calculateMacrosBtn.addEventListener('click', function() {
                debug('Натиснуто кнопку розрахунку макронутрієнтів');
                calculateMacros();
            });
            
            // Валідація при введенні
            document.getElementById('weight').addEventListener('input', validateWeight);
            document.getElementById('height').addEventListener('input', validateHeight);
            document.getElementById('age').addEventListener('input', validateAge);
            
            function validateWeight() {
                const weightInput = document.getElementById('weight');
                const weightError = document.getElementById('weight-error');
                const weight = parseFloat(weightInput.value);
                
                if (isNaN(weight) || weight < 30 || weight > 300) {
                    weightError.style.display = 'block';
                    return false;
                } else {
                    weightError.style.display = 'none';
                    return true;
                }
            }
            
            function validateHeight() {
                const heightInput = document.getElementById('height');
                const heightError = document.getElementById('height-error');
                const height = parseFloat(heightInput.value);
                
                if (isNaN(height) || height < 100 || height > 250) {
                    heightError.style.display = 'block';
                    return false;
                } else {
                    heightError.style.display = 'none';
                    return true;
                }
            }
            
            function validateAge() {
                const ageInput = document.getElementById('age');
                const ageError = document.getElementById('age-error');
                const age = parseInt(ageInput.value);
                
                if (isNaN(age) || age < 15 || age > 120) {
                    ageError.style.display = 'block';
                    return false;
                } else {
                    ageError.style.display = 'none';
                    return true;
                }
            }
            
            function calculateBMR() {
                debug('Початок розрахунку BMR');
                // Валідація всіх полів
                if (!validateWeight() || !validateHeight() || !validateAge()) {
                    debug('Помилка валідації');
                    return;
                }
                
                const gender = document.getElementById('gender').value;
                const weight = parseFloat(document.getElementById('weight').value);
                const height = parseFloat(document.getElementById('height').value);
                const age = parseInt(document.getElementById('age').value);
                
                debug(`Введені дані: стать=${gender}, вага=${weight}, зріст=${height}, вік=${age}`);
                
                // Отримуємо вибраний коефіцієнт активності
                let activity = 0;
                const activityElements = document.getElementsByName('activity');
                for (let i = 0; i < activityElements.length; i++) {
                    if (activityElements[i].checked) {
                        activity = parseFloat(activityElements[i].value);
                        break;
                    }
                }
                
                debug(`Коефіцієнт активності: ${activity}`);
                
                // Перевірка чи вибрано коефіцієнт активності
                if (activity === 0) {
                    alert('Будь ласка, виберіть коефіцієнт активності');
                    debug('Коефіцієнт активності не вибрано');
                    return;
                }
                
                // Отримуємо значення дефіциту/профіциту
                const deficitPercentage = parseInt(deficitSlider.value);
                debug(`Відсоток дефіциту/профіциту: ${deficitPercentage}`);
                
                // Розрахунок BMR за формулою
                let bmr = 0;
                if (gender === 'ч') {
                    bmr = Math.round(((88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age)) + 
                                     ((10 * weight) + (6.25 * height) + (8 * age) + 5)) / 2);
                } else if (gender === 'ж') {
                    bmr = Math.round(((447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age)) + 
                                     ((10 * weight) + (6.25 * height) + (8 * age) - 161)) / 2);
                }
                
                debug(`Розрахований BMR: ${bmr}`);
                
                // Розрахунок денної калорійності
                let dailyCalories = Math.round(bmr * activity);
                debug(`Денна калорійність: ${dailyCalories}`);
                
                // Відображення BMR і денної калорійності
                document.getElementById('bmr-value').textContent = bmr;
                document.getElementById('daily-calories').textContent = dailyCalories;
                
                // Опрацювання відсотка дефіциту/профіциту
                let adjustedCalories = dailyCalories;
                const adjustedCaloriesContainer = document.getElementById('adjusted-calories-container');
                
                if (deficitPercentage === 0) {
                    adjustedCaloriesContainer.style.display = 'none';
                    debug('Без змін калорійності');
                } else {
                    adjustedCalories = Math.round((100 + deficitPercentage) * dailyCalories / 100);
                    
                    if (deficitPercentage < 0) {
                        document.getElementById('deficit-type').textContent = `дефіциту ${Math.abs(deficitPercentage)}%`;
                        debug(`Дефіцит ${Math.abs(deficitPercentage)}%`);
                    } else {
                        document.getElementById('deficit-type').textContent = `профіциту ${deficitPercentage}%`;
                        debug(`Профіцит ${deficitPercentage}%`);
                    }
                    
                    document.getElementById('adjusted-calories').textContent = adjustedCalories;
                    adjustedCaloriesContainer.style.display = 'block';
                    debug(`Скоригована калорійність: ${adjustedCalories}`);
                }
                
                // Показуємо результати
                document.getElementById('bmr-results').style.display = 'block';
                
                // Зберігаємо калорії для розрахунку макронутрієнтів
                window.calculatedData.adjustedCalories = adjustedCalories;
                window.calculatedData.weight = weight;
                window.calculatedData.bmr = bmr;
                window.calculatedData.dailyCalories = dailyCalories;
                
                debug('Розрахунок BMR завершено і дані збережено для подальшого використання');
            }
            
            function calculateMacros() {
                debug('Початок розрахунку макронутрієнтів');
                if (!window.calculatedData.adjustedCalories || !window.calculatedData.weight) {
                    alert('Спочатку розрахуйте BMR і денну калорійність.');
                    debug('Калорійність не розрахована');
                    return;
                }
                
                const proteinPerKg = parseFloat(document.getElementById('protein').value);
                const fatPerKg = parseFloat(document.getElementById('fat').value);
                
                debug(`Білків на кг: ${proteinPerKg}, Жирів на кг: ${fatPerKg}`);
                
                // Розрахунок граммовки макронутрієнтів
                const proteinGrams = Math.round(proteinPerKg * window.calculatedData.weight);
                const fatGrams = Math.round(fatPerKg * window.calculatedData.weight);
                
                debug(`Граммовка білків: ${proteinGrams}, жирів: ${fatGrams}`);
                
                // Розрахунок калорій від білків і жирів
                const proteinCalories = proteinGrams * 4;
                const fatCalories = fatGrams * 9;
                 
                debug(`Калорії з білків: ${proteinCalories}, з жирів: ${fatCalories}`);
                
                // Розрахунок грамів вуглеводів
                const remainingCalories = window.calculatedData.adjustedCalories - (proteinCalories + fatCalories);
                const carbGrams = Math.round(remainingCalories / 4);
                const carbCalories = carbGrams * 4;
                
                debug(`Залишок калорій для вуглеводів: ${remainingCalories}`);
                debug(`Граммовка вуглеводів: ${carbGrams}, калорій: ${carbCalories}`);
                
                // Відображення результатів
                document.getElementById('protein-g').textContent = proteinGrams;
                document.getElementById('protein-cal').textContent = proteinCalories;
                document.getElementById('fat-g').textContent = fatGrams;
                document.getElementById('fat-cal').textContent = fatCalories;
                document.getElementById('carbs-g').textContent = carbGrams;
                document.getElementById('carbs-cal').textContent = carbCalories;
                
                document.getElementById('macro-results').style.display = 'block';
                debug('Розрахунок макронутрієнтів завершено');
            }
            
            // Преселекція першого варіанту активності для зручності
            document.getElementById('activity1').checked = true;
        });
    </script>
</body>
</html>